{
  "project": {
    "name": "Core RAG Engine - Frontend",
    "version": "1.1.0",
    "description": "Moteur RAG Multi-Verticales - Frontend React avec Supabase - Intégration RAG complète",
    "framework": "React + Vite",
    "status": "Bloc 1 terminé + Intégration RAG-Brain",
    "date": "2025-11-27",
    "features": [
      "Authentification complète (Email/Password, Google SSO)",
      "Onboarding utilisateur",
      "Dashboard avec interface RAG",
      "Intégration Edge Function rag-brain",
      "Gestion de l'historique de conversation",
      "Affichage des sources et métriques"
    ]
  },
  "structure": {
    "src/contexts/": "Gestion de l'authentification (AuthContext)",
    "src/lib/": "Client Supabase et helpers (inclut callRagBrain)",
    "src/components/": "Composants réutilisables (OnboardingGuard, UserMenu)",
    "src/pages/": "Pages principales (Login, Dashboard avec RAG, Settings, ResetPassword, Onboarding)",
    "Configuration": "Vite, Tailwind CSS, React Router",
    "Documentation": "RAG_BRAIN_DOCUMENTATION.md"
  },
  "files": {
    "index.html": "<!DOCTYPE html>\n<html lang=\"fr\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <link rel=\"icon\" type=\"image/svg+xml\" href=\"/vite.svg\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <meta name=\"description\" content=\"Core RAG Engine - Moteur d'IA Contextuelle Multi-Verticales\" />\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <title>Core RAG Engine</title>\n  </head>\n  <body>\n    <div id=\"root\"></div>\n    <script type=\"module\" src=\"/src/main.jsx\"></script>\n  </body>\n</html>\n",
    "vite.config.js": "import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  resolve: {\n    alias: {\n      '@': '/src',\n    },\n  },\n  server: {\n    port: 5173,\n    open: true,\n  },\n})\n",
    "tailwind.config.js": "/** @type {import('tailwindcss').Config} */\nexport default {\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{js,ts,jsx,tsx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        // Couleurs personnalisées pour le Core RAG Engine\n        primary: {\n          50: '#eff6ff',\n          100: '#dbeafe',\n          200: '#bfdbfe',\n          300: '#93c5fd',\n          400: '#60a5fa',\n          500: '#3b82f6',\n          600: '#2563eb',\n          700: '#1d4ed8',\n          800: '#1e40af',\n          900: '#1e3a8a',\n          950: '#172554',\n        },\n        secondary: {\n          50: '#f8fafc',\n          100: '#f1f5f9',\n          200: '#e2e8f0',\n          300: '#cbd5e1',\n          400: '#94a3b8',\n          500: '#64748b',\n          600: '#475569',\n          700: '#334155',\n          800: '#1e293b',\n          900: '#0f172a',\n          950: '#020617',\n        },\n      },\n      fontFamily: {\n        sans: ['Inter', 'system-ui', 'sans-serif'],\n      },\n    },\n  },\n  plugins: [],\n}\n",
    "package.json": "{\n  \"name\": \"core-rag-engine\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Moteur RAG Multi-Verticales - Core Engine\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"vite build\",\n    \"preview\": \"vite preview\",\n    \"lint\": \"eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0\"\n  },\n  \"dependencies\": {\n    \"@supabase/supabase-js\": \"^2.45.0\",\n    \"react\": \"^18.3.1\",\n    \"react-dom\": \"^18.3.1\",\n    \"react-router-dom\": \"^6.26.0\",\n    \"lucide-react\": \"^0.441.0\"\n  },\n  \"devDependencies\": {\n    \"@types/react\": \"^18.3.3\",\n    \"@types/react-dom\": \"^18.3.0\",\n    \"@vitejs/plugin-react\": \"^4.3.1\",\n    \"autoprefixer\": \"^10.4.20\",\n    \"eslint\": \"^8.57.0\",\n    \"eslint-plugin-react\": \"^7.34.3\",\n    \"eslint-plugin-react-hooks\": \"^4.6.2\",\n    \"eslint-plugin-react-refresh\": \"^0.4.7\",\n    \"postcss\": \"^8.4.41\",\n    \"tailwindcss\": \"^3.4.10\",\n    \"vite\": \"^5.4.2\"\n  }\n}\n",
    "src/main.jsx": "/**\n * main.jsx - Core RAG Engine\n * ============================================================================\n * Point d'entrée principal de l'application React.\n * Monte l'application dans le DOM.\n * ============================================================================\n */\n\nimport React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App.jsx'\nimport './index.css'\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n)\n",
    "src/index.css": "@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* ============================================================================\n   CORE RAG ENGINE - Styles personnalisés\n   ============================================================================ */\n\n@layer base {\n  html {\n    font-family: 'Inter', system-ui, sans-serif;\n  }\n  \n  body {\n    @apply bg-secondary-50 text-secondary-900 antialiased;\n  }\n}\n\n@layer components {\n  /* Boutons */\n  .btn {\n    @apply inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed;\n  }\n  \n  .btn-primary {\n    @apply btn bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500;\n  }\n  \n  .btn-secondary {\n    @apply btn bg-secondary-200 text-secondary-800 hover:bg-secondary-300 focus:ring-secondary-400;\n  }\n  \n  .btn-outline {\n    @apply btn border-2 border-primary-600 text-primary-600 hover:bg-primary-50 focus:ring-primary-500;\n  }\n  \n  /* Inputs */\n  .input {\n    @apply w-full px-4 py-2 rounded-lg border border-secondary-300 bg-white text-secondary-900 placeholder-secondary-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent;\n  }\n  \n  .input-error {\n    @apply input border-red-500 focus:ring-red-500;\n  }\n  \n  /* Cards */\n  .card {\n    @apply bg-white rounded-xl shadow-sm border border-secondary-200 p-6;\n  }\n  \n  .card-hover {\n    @apply card hover:shadow-md hover:border-primary-300 transition-all duration-200 cursor-pointer;\n  }\n  \n  /* Labels */\n  .label {\n    @apply block text-sm font-medium text-secondary-700 mb-1;\n  }\n  \n  /* Erreurs */\n  .error-text {\n    @apply text-sm text-red-600 mt-1;\n  }\n  \n  /* Liens */\n  .link {\n    @apply text-primary-600 hover:text-primary-700 font-medium transition-colors;\n  }\n}\n\n@layer utilities {\n  /* Animation de chargement */\n  .animate-spin-slow {\n    animation: spin 2s linear infinite;\n  }\n  \n  /* Fond avec motif */\n  .bg-pattern {\n    background-image: url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n  }\n}\n",
    "src/App.jsx": "/**\n * App.jsx - Core RAG Engine\n * ============================================================================\n * Point d'entrée de l'application React.\n * Configure le Router et les Guards de protection des routes.\n * ============================================================================\n */\n\nimport { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom'\nimport { AuthProvider } from './contexts/AuthContext'\nimport { \n  ProtectedRoute, \n  OnboardingRoute, \n  PublicRoute \n} from './components/OnboardingGuard'\n\n// Pages\nimport Login from './pages/Login'\nimport ResetPassword from './pages/ResetPassword'\nimport Onboarding from './pages/Onboarding'\nimport Dashboard from './pages/Dashboard'\nimport Settings from './pages/Settings'\n\nfunction App() {\n  return (\n    <BrowserRouter\n      future={{\n        v7_startTransition: true,\n      }}\n    >\n      <AuthProvider>\n        <Routes>\n          {/* Routes publiques (redirige si déjà connecté) */}\n          <Route \n            path=\"/login\" \n            element={\n              <PublicRoute>\n                <Login />\n              </PublicRoute>\n            } \n          />\n          \n          {/* Route de réinitialisation de mot de passe (publique) */}\n          <Route \n            path=\"/reset-password\" \n            element={<ResetPassword />} \n          />\n          \n          {/* Route d'onboarding (requiert auth, redirige si déjà onboardé) */}\n          <Route \n            path=\"/onboarding\" \n            element={\n              <OnboardingRoute>\n                <Onboarding />\n              </OnboardingRoute>\n            } \n          />\n          \n          {/* Routes protégées (requiert auth + onboarding complété) */}\n          <Route \n            path=\"/dashboard\" \n            element={\n              <ProtectedRoute>\n                <Dashboard />\n              </ProtectedRoute>\n            } \n          />\n          \n          {/* Route des paramètres (protégée) */}\n          <Route \n            path=\"/settings\" \n            element={\n              <ProtectedRoute>\n                <Settings />\n              </ProtectedRoute>\n            } \n          />\n          \n          {/* Redirection par défaut */}\n          <Route path=\"/\" element={<Navigate to=\"/dashboard\" replace />} />\n          \n          {/* 404 - Route non trouvée */}\n          <Route path=\"*\" element={<Navigate to=\"/dashboard\" replace />} />\n        </Routes>\n      </AuthProvider>\n    </BrowserRouter>\n  )\n}\n\nexport default App\n",
    "src/contexts/AuthContext.jsx": "import { createContext, useContext, useEffect, useState, useCallback, useRef } from 'react'\nimport { supabase } from '../lib/supabaseClient'\nimport * as supabaseHelpers from '../lib/supabaseClient'\n\nconst AuthContext = createContext({})\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext)\n  if (!context) {\n    throw new Error('useAuth doit être utilisé dans un AuthProvider')\n  }\n  return context\n}\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState(null)\n  const [session, setSession] = useState(null)\n  const [profile, setProfile] = useState(null)\n  const [organization, setOrganization] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n  \n  const profileLoadedRef = useRef(false)\n  const loadingProfileRef = useRef(false)\n  const signingUpRef = useRef(false)\n  const loadUserProfile = useCallback(async (userId) => {\n    if (loadingProfileRef.current) {\n      return\n    }\n    \n    loadingProfileRef.current = true\n    \n    try {\n      const { data: profileData, error: profileError } = await supabase\n        .from('profiles')\n        .select('*')\n        .eq('id', userId)\n        .single()\n\n      if (profileError) {\n        if (profileError.code === 'PGRST116') {\n          setProfile(null)\n          setOrganization(null)\n          profileLoadedRef.current = true\n          return\n        }\n        throw profileError\n      }\n\n      setProfile(profileData)\n\n      if (profileData?.org_id) {\n        const { data: orgData, error: orgError } = await supabase\n          .from('organizations')\n          .select('*')\n          .eq('id', profileData.org_id)\n          .single()\n\n        if (!orgError) {\n          setOrganization(orgData)\n        }\n      }\n      \n      profileLoadedRef.current = true\n    } catch (err) {\n      setError(err.message)\n      profileLoadedRef.current = true\n    } finally {\n      loadingProfileRef.current = false\n    }\n  }, [])\n\n  useEffect(() => {\n    let mounted = true\n    \n    const initSession = async () => {\n      try {\n        const { data: { session: initialSession } } = await supabase.auth.getSession()\n        \n        if (!mounted) return\n        \n        setSession(initialSession)\n        setUser(initialSession?.user ?? null)\n\n        if (initialSession?.user) {\n          await loadUserProfile(initialSession.user.id)\n        }\n      } catch (err) {\n        if (mounted) setError(err.message)\n      } finally {\n        if (mounted) setLoading(false)\n      }\n    }\n\n    initSession()\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event, newSession) => {\n        if (!mounted) return\n        \n        setSession(newSession)\n        setUser(newSession?.user ?? null)\n\n        if (event === 'SIGNED_IN' && newSession?.user) {\n          profileLoadedRef.current = false\n          loadingProfileRef.current = false\n          \n          setTimeout(async () => {\n            if (mounted) {\n              await loadUserProfile(newSession.user.id)\n              setLoading(false)\n            }\n          }, 1000)\n        } else if (event === 'SIGNED_OUT') {\n          setProfile(null)\n          setOrganization(null)\n          profileLoadedRef.current = false\n          loadingProfileRef.current = false\n          setLoading(false)\n        } else {\n          setLoading(false)\n        }\n      }\n    )\n\n    return () => {\n      mounted = false\n      subscription?.unsubscribe()\n    }\n  }, [loadUserProfile])\n\n  const signUp = async (email, password, metadata = {}) => {\n    if (signingUpRef.current) {\n      return { data: null, error: { message: 'Une inscription est déjà en cours.' } }\n    }\n\n    signingUpRef.current = true\n    setLoading(true)\n\n    try {\n      if (supabaseHelpers.checkEmailExists && typeof supabaseHelpers.checkEmailExists === 'function') {\n        try {\n          const emailExists = await supabaseHelpers.checkEmailExists(email)\n          \n          if (emailExists === true) {\n            const errorMessage = 'Un compte existe déjà avec cet email. Veuillez vous connecter ou utiliser la réinitialisation de mot de passe.'\n            setError(errorMessage)\n            signingUpRef.current = false\n            setLoading(false)\n            \n            return {\n              data: null,\n              error: {\n                message: errorMessage,\n                code: 'EMAIL_EXISTS'\n              }\n            }\n          }\n        } catch (checkErr) {\n          // Continue l'inscription même si la vérification échoue\n        }\n      }\n\n      const { data, error } = await supabase.auth.signUp({\n        email,\n        password,\n        options: {\n          data: metadata,\n        },\n      })\n\n      if (error) {\n        const errorMessage = error.message || ''\n        const errorStatus = error.status || error.code || ''\n        const errorLower = errorMessage.toLowerCase()\n        \n        const isEmailExists = \n          errorStatus === 422 || \n          errorStatus === 400 ||\n          errorLower.includes('already') ||\n          errorLower.includes('exists') ||\n          errorLower.includes('registered') ||\n          errorLower.includes('duplicate') ||\n          errorMessage === 'User already registered' ||\n          errorMessage === 'Email already registered' ||\n          errorMessage === 'A user with this email already exists'\n\n        if (isEmailExists) {\n          return { \n            data: null, \n            error: { \n              message: 'Un compte existe déjà avec cet email. Veuillez vous connecter ou utiliser la réinitialisation de mot de passe.',\n              code: 'EMAIL_EXISTS',\n              originalError: error\n            } \n          }\n        }\n        \n        return { data: null, error: error }\n      }\n\n      signingUpRef.current = false\n      return { data, error: null }\n    } catch (err) {\n      const errorMessage = err?.message || 'Une erreur inattendue s\\'est produite.'\n      setError(errorMessage)\n      signingUpRef.current = false\n      return { \n        data: null, \n        error: { \n          message: errorMessage,\n          code: 'UNKNOWN_ERROR'\n        } \n      }\n    } finally {\n      setLoading(false)\n      signingUpRef.current = false\n    }\n  }\n\n  const signIn = async (email, password) => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      })\n\n      if (error) throw error\n\n      return { data, error: null }\n    } catch (err) {\n      setError(err.message)\n      return { data: null, error: err }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const signInWithGoogle = async () => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      const { data, error } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n        options: {\n          redirectTo: `${window.location.origin}/dashboard`,\n        },\n      })\n\n      if (error) throw error\n\n      return { data, error: null }\n    } catch (err) {\n      setError(err.message)\n      return { data: null, error: err }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const signOut = async () => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      const { error } = await supabase.auth.signOut()\n      if (error) throw error\n\n      setUser(null)\n      setSession(null)\n      setProfile(null)\n      setOrganization(null)\n      profileLoadedRef.current = false\n\n      return { error: null }\n    } catch (err) {\n      setError(err.message)\n      return { error: err }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const refreshProfile = async () => {\n    if (user?.id) {\n      profileLoadedRef.current = false\n      loadingProfileRef.current = false\n      await loadUserProfile(user.id)\n    }\n  }\n\n  const resetPassword = async (email) => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      const { data, error } = await supabase.auth.resetPasswordForEmail(email, {\n        redirectTo: `${window.location.origin}/reset-password`,\n      })\n\n      if (error) throw error\n\n      return { data, error: null }\n    } catch (err) {\n      setError(err.message)\n      return { data: null, error: err }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const updatePassword = async (newPassword) => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      const { data, error } = await supabase.auth.updateUser({\n        password: newPassword,\n      })\n\n      if (error) throw error\n\n      return { data, error: null }\n    } catch (err) {\n      setError(err.message)\n      return { data: null, error: err }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const clearError = () => {\n    setError(null)\n  }\n\n  const value = {\n    user,\n    session,\n    profile,\n    organization,\n    loading,\n    error,\n    isAuthenticated: !!session,\n    isOnboarded: !!profile?.business_role,\n    isOrgAdmin: profile?.app_role === 'org_admin' || profile?.app_role === 'super_admin',\n    isSuperAdmin: profile?.app_role === 'super_admin',\n    hasProfile: !!profile,\n    signUp,\n    signIn,\n    signInWithGoogle,\n    signOut,\n    refreshProfile,\n    resetPassword,\n    updatePassword,\n    clearError,\n  }\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport default AuthContext\n\n",
    "src/lib/supabaseClient.js": "import { createClient } from '@supabase/supabase-js'\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error(\n    '❌ Variables Supabase manquantes!\\n' +\n    'Assurez-vous de créer un fichier .env.local avec:\\n' +\n    '- VITE_SUPABASE_URL\\n' +\n    '- VITE_SUPABASE_ANON_KEY\\n' +\n    'Consultez .env.example pour plus de détails.'\n  )\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n  auth: {\n    persistSession: true,\n    autoRefreshToken: true,\n    detectSessionInUrl: true,\n  },\n})\nexport async function getMyProfile() {\n  const { data, error } = await supabase.rpc('get_my_profile')\n  if (error) return null\n  return data\n}\n\nexport async function completeOnboarding(businessRole, bio = null) {\n  const { data, error } = await supabase.rpc('complete_onboarding', {\n    p_business_role: businessRole,\n    p_bio: bio,\n  })\n  \n  if (error) throw error\n  return data\n}\n\nexport async function checkEmailExists(email) {\n  if (!email) return false\n  \n  try {\n    const { data, error } = await supabase.rpc('check_email_exists', {\n      email_to_check: email\n    })\n    \n    if (error) return false\n    \n    return data === true || data === 'true' || data === 1\n  } catch (err) {\n    return false\n  }\n}\n\n/**\n * Appelle la fonction Edge Function rag-brain de Supabase\n * @param {string} query - La question/requête de l'utilisateur\n * @param {string} verticalId - L'ID de la verticale (requis)\n * @param {object} options - Options supplémentaires\n * @returns {Promise<{data: any, error: Error|null}>}\n */\nexport async function callRagBrain(query, verticalId, options = {}) {\n  try {\n    // Récupérer la session pour l'authentification\n    const { data: { session } } = await supabase.auth.getSession()\n    \n    if (!session) {\n      throw new Error('Utilisateur non authentifié')\n    }\n\n    if (!query || query.trim() === '') {\n      throw new Error('La requête ne peut pas être vide')\n    }\n\n    if (!verticalId || verticalId.trim() === '') {\n      throw new Error('L\\'ID de la verticale est requis')\n    }\n\n    // Construire le body selon le format attendu par votre Edge Function\n    const requestBody = {\n      query: query.trim(),\n      vertical_id: verticalId.trim(),\n      match_threshold: options.matchThreshold || 0.5,\n      match_count: options.matchCount || 5\n    }\n\n    // Appel à l'Edge Function\n    const response = await fetch(\n      `${supabaseUrl}/functions/v1/rag-brain`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'apikey': supabaseAnonKey,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody),\n      }\n    )\n\n    const data = await response.json()\n\n    if (!response.ok) {\n      // Gérer les erreurs selon le format de votre Edge Function\n      const errorMessage = data.error || `Erreur HTTP: ${response.status}`\n      throw new Error(errorMessage)\n    }\n\n    // Vérifier le format de réponse\n    if (!data.success) {\n      throw new Error(data.error || 'Erreur inconnue de l\\'Edge Function')\n    }\n\n    return { \n      data: {\n        answer: data.answer,\n        sources: data.sources || [],\n        processingTime: data.processing_time_ms\n      }, \n      error: null \n    }\n  } catch (err) {\n    console.error('Erreur lors de l\\'appel RAG:', err)\n    return { \n      data: null, \n      error: err instanceof Error ? err : new Error(String(err))\n    }\n  }\n}\n\nexport default supabase\n",
    "src/components/OnboardingGuard.jsx": "import { Navigate, useLocation } from 'react-router-dom'\nimport { useAuth } from '../contexts/AuthContext'\nimport { Loader2, AlertTriangle } from 'lucide-react'\n\nfunction LoadingScreen() {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-secondary-50\">\n      <div className=\"text-center\">\n        <Loader2 className=\"w-12 h-12 animate-spin text-primary-600 mx-auto\" />\n        <p className=\"mt-4 text-secondary-600\">Chargement...</p>\n      </div>\n    </div>\n  )\n}\n\nfunction ProfileErrorScreen({ onRetry, onSignOut }) {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-secondary-50 p-4\">\n      <div className=\"bg-white rounded-xl shadow-lg p-8 max-w-md text-center\">\n        <div className=\"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <AlertTriangle className=\"w-8 h-8 text-amber-600\" />\n        </div>\n        <h2 className=\"text-xl font-semibold text-secondary-900 mb-2\">\n          Profil non trouvé\n        </h2>\n        <p className=\"text-secondary-600 mb-6\">\n          Votre compte a été créé mais le profil n'a pas été initialisé correctement. \n          Cela peut arriver si le trigger de base de données n'a pas fonctionné.\n        </p>\n        <div className=\"flex gap-3 justify-center\">\n          <button\n            onClick={onRetry}\n            className=\"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors\"\n          >\n            Réessayer\n          </button>\n          <button\n            onClick={onSignOut}\n            className=\"px-4 py-2 bg-secondary-200 text-secondary-700 rounded-lg hover:bg-secondary-300 transition-colors\"\n          >\n            Se déconnecter\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n/**\n * Guard pour les routes nécessitant une authentification\n * Vérifie également que l'onboarding est complété\n */\nexport function ProtectedRoute({ children }) {\n  const { isAuthenticated, isOnboarded, hasProfile, loading, refreshProfile, signOut } = useAuth()\n  const location = useLocation()\n\n  // En cours de chargement\n  if (loading) {\n    return <LoadingScreen />\n  }\n\n  // Non authentifié → Login\n  if (!isAuthenticated) {\n    return <Navigate to=\"/login\" state={{ from: location }} replace />\n  }\n\n  // Authentifié mais pas de profil → Erreur\n  if (!hasProfile) {\n    return <ProfileErrorScreen onRetry={refreshProfile} onSignOut={signOut} />\n  }\n\n  if (!isOnboarded) {\n    return <Navigate to=\"/onboarding\" replace />\n  }\n\n  return children\n}\n\nexport function OnboardingRoute({ children }) {\n  const { isAuthenticated, isOnboarded, hasProfile, loading, refreshProfile, signOut } = useAuth()\n  const location = useLocation()\n\n  // En cours de chargement\n  if (loading) {\n    return <LoadingScreen />\n  }\n\n  // Non authentifié → Login\n  if (!isAuthenticated) {\n    return <Navigate to=\"/login\" state={{ from: location }} replace />\n  }\n\n  // Authentifié mais pas de profil → Erreur\n  if (!hasProfile) {\n    return <ProfileErrorScreen onRetry={refreshProfile} onSignOut={signOut} />\n  }\n\n  if (isOnboarded) {\n    return <Navigate to=\"/dashboard\" replace />\n  }\n\n  return children\n}\n\nexport function PublicRoute({ children }) {\n  const { isAuthenticated, isOnboarded, hasProfile, loading } = useAuth()\n\n  if (loading) {\n    return <LoadingScreen />\n  }\n\n  if (isAuthenticated) {\n    if (!hasProfile) {\n      return children\n    }\n    if (!isOnboarded) {\n      return <Navigate to=\"/onboarding\" replace />\n    }\n    return <Navigate to=\"/dashboard\" replace />\n  }\n\n  return children\n}\n\nexport function AdminRoute({ children }) {\n  const { isAuthenticated, isOnboarded, isOrgAdmin, hasProfile, loading, refreshProfile, signOut } = useAuth()\n  const location = useLocation()\n\n  if (loading) {\n    return <LoadingScreen />\n  }\n\n  // Non authentifié → Login\n  if (!isAuthenticated) {\n    return <Navigate to=\"/login\" state={{ from: location }} replace />\n  }\n\n  if (!hasProfile) {\n    return <ProfileErrorScreen onRetry={refreshProfile} onSignOut={signOut} />\n  }\n\n  if (!isOnboarded) {\n    return <Navigate to=\"/onboarding\" replace />\n  }\n\n  if (!isOrgAdmin) {\n    return <Navigate to=\"/dashboard\" replace />\n  }\n\n  return children\n}\n\nexport default ProtectedRoute\n\n",
    "src/components/UserMenu.jsx": "import { useState, useRef, useEffect } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { \n  User, \n  Settings, \n  Users, \n  Sun, \n  Moon,\n  LogOut,\n  Check,\n  Globe\n} from 'lucide-react'\n\nexport default function UserMenu({ user, profile, organization, onSignOut }) {\n  const navigate = useNavigate()\n  const [isOpen, setIsOpen] = useState(false)\n  const [darkMode, setDarkMode] = useState(false)\n  const [language, setLanguage] = useState('fr')\n  const menuRef = useRef(null)\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (menuRef.current && !menuRef.current.contains(event.target)) {\n        setIsOpen(false)\n      }\n    }\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [isOpen])\n\n  const getInitials = () => {\n    if (profile?.full_name) {\n      const names = profile.full_name.split(' ')\n      if (names.length >= 2) {\n        return (names[0][0] + names[names.length - 1][0]).toUpperCase()\n      }\n      return names[0][0].toUpperCase()\n    }\n    if (user?.email) {\n      return user.email[0].toUpperCase()\n    }\n    return 'U'\n  }\n\n  const getAvatarColor = () => {\n    const colors = [\n      'bg-red-500',\n      'bg-blue-500',\n      'bg-green-500',\n      'bg-purple-500',\n      'bg-pink-500',\n      'bg-indigo-500',\n      'bg-yellow-500',\n      'bg-teal-500'\n    ]\n    const hash = user?.id?.charCodeAt(0) || 0\n    return colors[hash % colors.length]\n  }\n\n  const handleToggleDarkMode = () => {\n    setDarkMode(!darkMode)\n  }\n\n  const handleLanguageChange = (lang) => {\n    setLanguage(lang)\n  }\n\n  return (\n    <div className=\"relative\" ref={menuRef}>\n      {/* Bouton avatar */}\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center gap-2 p-1 rounded-lg hover:bg-secondary-100 transition-colors\"\n      >\n        <div className={`w-10 h-10 ${getAvatarColor()} rounded-full flex items-center justify-center text-white font-semibold text-sm`}>\n          {profile?.avatar_url ? (\n            <img \n              src={profile.avatar_url} \n              alt=\"Avatar\" \n              className=\"w-10 h-10 rounded-full object-cover\"\n            />\n          ) : (\n            getInitials()\n          )}\n        </div>\n      </button>\n\n      {/* Dropdown menu */}\n      {isOpen && (\n        <div className=\"absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-lg border border-secondary-200 z-50\">\n          {/* Informations utilisateur */}\n          <div className=\"p-4 border-b border-secondary-200\">\n            <div className=\"flex items-center gap-3\">\n              <div className={`w-12 h-12 ${getAvatarColor()} rounded-full flex items-center justify-center text-white font-semibold`}>\n                {profile?.avatar_url ? (\n                  <img \n                    src={profile.avatar_url} \n                    alt=\"Avatar\" \n                    className=\"w-12 h-12 rounded-full object-cover\"\n                  />\n                ) : (\n                  getInitials()\n                )}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"font-semibold text-secondary-900 truncate\">\n                  {profile?.full_name || user?.email?.split('@')[0] || 'Utilisateur'}\n                </p>\n                <p className=\"text-sm text-secondary-500 truncate\">\n                  {user?.email}\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Options */}\n          <div className=\"p-2\">\n            <button\n              onClick={() => {\n                setIsOpen(false)\n                navigate('/settings')\n              }}\n              className=\"w-full flex items-center gap-3 px-3 py-2 text-sm text-secondary-700 hover:bg-secondary-50 rounded-lg transition-colors\"\n            >\n              <Settings className=\"w-4 h-4\" />\n              <span>Paramètres</span>\n            </button>\n\n            <button\n              onClick={() => setIsOpen(false)}\n              className=\"w-full flex items-center gap-3 px-3 py-2 text-sm text-secondary-700 hover:bg-secondary-50 rounded-lg transition-colors\"\n            >\n              <Users className=\"w-4 h-4\" />\n              <span>Passez sur Ordalie Pro</span>\n            </button>\n\n            <button\n              onClick={handleToggleDarkMode}\n              className=\"w-full flex items-center gap-3 px-3 py-2 text-sm text-secondary-700 hover:bg-secondary-50 rounded-lg transition-colors\"\n            >\n              {darkMode ? (\n                <Moon className=\"w-4 h-4\" />\n              ) : (\n                <Sun className=\"w-4 h-4\" />\n              )}\n              <span>Mode sombre</span>\n            </button>\n          </div>\n\n          {/* Sélection de langue */}\n          <div className=\"p-2 border-t border-secondary-200\">\n            <div className=\"px-3 py-2 text-xs font-medium text-secondary-500 uppercase tracking-wide\">\n              Langue\n            </div>\n            <button\n              onClick={() => handleLanguageChange('fr')}\n              className={`w-full flex items-center justify-between px-3 py-2 text-sm rounded-lg transition-colors ${\n                language === 'fr' \n                  ? 'bg-secondary-100 text-secondary-900' \n                  : 'text-secondary-700 hover:bg-secondary-50'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <Globe className=\"w-4 h-4\" />\n                <span>Français FR</span>\n              </div>\n              {language === 'fr' && (\n                <Check className=\"w-4 h-4 text-primary-600\" />\n              )}\n            </button>\n            <button\n              onClick={() => handleLanguageChange('en')}\n              className={`w-full flex items-center justify-between px-3 py-2 text-sm rounded-lg transition-colors ${\n                language === 'en' \n                  ? 'bg-secondary-100 text-secondary-900' \n                  : 'text-secondary-700 hover:bg-secondary-50'\n              }`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <Globe className=\"w-4 h-4\" />\n                <span>English GB</span>\n              </div>\n              {language === 'en' && (\n                <Check className=\"w-4 h-4 text-primary-600\" />\n              )}\n            </button>\n          </div>\n\n          {/* Déconnexion */}\n          <div className=\"p-2 border-t border-secondary-200\">\n            <button\n              onClick={() => {\n                setIsOpen(false)\n                onSignOut()\n              }}\n              className=\"w-full flex items-center gap-3 px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\n            >\n              <LogOut className=\"w-4 h-4\" />\n              <span>Déconnexion</span>\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\n",
    "src/pages/Login.jsx": "/**\n * Page Login - Core RAG Engine\n * ============================================================================\n * Page d'authentification avec:\n * - Formulaire Email/Password\n * - Option Google SSO\n * - Toggle Connexion/Inscription\n * ============================================================================\n */\n\nimport { useState, useEffect, useRef } from 'react'\nimport { useAuth } from '../contexts/AuthContext'\nimport { \n  Mail, \n  Lock, \n  User, \n  Eye, \n  EyeOff, \n  Loader2,\n  AlertCircle,\n  Sparkles\n} from 'lucide-react'\n\nexport default function Login() {\n  const [isSignUp, setIsSignUp] = useState(false)\n  const [isResetPassword, setIsResetPassword] = useState(false)\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [fullName, setFullName] = useState('')\n  const [resetEmail, setResetEmail] = useState('')\n  const [showPassword, setShowPassword] = useState(false)\n  const [formError, setFormError] = useState('')\n  const [successMessage, setSuccessMessage] = useState('')\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [isRedirecting, setIsRedirecting] = useState(false)\n  const wasAuthenticatedRef = useRef(false)\n\n  const { signIn, signUp, signInWithGoogle, resetPassword, loading, error, clearError, isAuthenticated } = useAuth()\n\n  useEffect(() => {\n    if (isAuthenticated && !wasAuthenticatedRef.current) {\n      setIsRedirecting(true)\n    }\n    wasAuthenticatedRef.current = isAuthenticated\n  }, [isAuthenticated])\n  \n  useEffect(() => {\n    if (!isAuthenticated && isRedirecting) {\n      setIsRedirecting(false)\n    }\n  }, [isAuthenticated, isRedirecting])\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    \n    if (isSubmitting) {\n      return\n    }\n    \n    setIsSubmitting(true)\n    setFormError('')\n    setSuccessMessage('')\n\n    if (!email || !password) {\n      setFormError('Veuillez remplir tous les champs obligatoires.')\n      setIsSubmitting(false)\n      return\n    }\n\n    if (password.length < 6) {\n      setFormError('Le mot de passe doit contenir au moins 6 caractères.')\n      setIsSubmitting(false)\n      return\n    }\n\n    try {\n      if (isSignUp) {\n        const result = await signUp(email, password, { full_name: fullName })\n        const { data, error } = result || {}\n        \n        if (error) {\n          const errorMessage = error?.message || error?.toString() || 'Une erreur est survenue lors de l\\'inscription.'\n          setFormError(errorMessage)\n        } else {\n          setSuccessMessage('Compte créé avec succès ! Vérifiez votre email pour confirmer votre inscription.')\n        }\n      } else {\n        const { error } = await signIn(email, password)\n        if (error) {\n          setFormError(translateError(error.message))\n          setIsSubmitting(false)\n        } else {\n          setIsRedirecting(true)\n        }\n      }\n    } catch (err) {\n      setFormError(err?.message || 'Une erreur inattendue s\\'est produite.')\n      setIsSubmitting(false)\n      setIsRedirecting(false)\n    } finally {\n      if (!isRedirecting) {\n        setIsSubmitting(false)\n      }\n    }\n  }\n\n  /**\n   * Connexion avec Google\n   */\n  const handleGoogleSignIn = async () => {\n    setFormError('')\n    const { error } = await signInWithGoogle()\n    if (error) {\n      setFormError(error.message)\n    }\n  }\n\n  const handleResetPassword = async (e) => {\n    e.preventDefault()\n    \n    if (isSubmitting) {\n      return\n    }\n    \n    setIsSubmitting(true)\n    setFormError('')\n    setSuccessMessage('')\n\n    if (!resetEmail) {\n      setFormError('Veuillez saisir votre adresse email.')\n      setIsSubmitting(false)\n      return\n    }\n\n    try {\n      const { error } = await resetPassword(resetEmail)\n      if (error) {\n        setFormError(error.message || 'Une erreur est survenue lors de l\\'envoi de l\\'email.')\n      } else {\n        setSuccessMessage('Un email de réinitialisation a été envoyé. Vérifiez votre boîte de réception.')\n        setResetEmail('')\n      }\n    } catch (err) {\n      setFormError(err?.message || 'Une erreur inattendue s\\'est produite.')\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const translateError = (message) => {\n    const errors = {\n      'Invalid login credentials': 'Email ou mot de passe incorrect.',\n      'Email not confirmed': 'Veuillez confirmer votre email avant de vous connecter.',\n      'User already registered': 'Un compte existe déjà avec cet email.',\n    }\n    return errors[message] || message\n  }\n\n  if (isRedirecting) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-secondary-50\">\n        <div className=\"text-center\">\n          <Loader2 className=\"w-16 h-16 animate-spin text-primary-600 mx-auto mb-4\" />\n          <p className=\"text-secondary-900 text-lg font-semibold\">Connexion réussie !</p>\n          <p className=\"text-secondary-600 text-sm mt-2\">Redirection en cours...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen flex bg-pattern\">\n      {/* Panneau gauche - Branding */}\n      <div className=\"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary-600 to-primary-800 p-12 flex-col justify-between\">\n        <div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center\">\n              <Sparkles className=\"w-6 h-6 text-white\" />\n            </div>\n            <span className=\"text-2xl font-bold text-white\">Core RAG</span>\n          </div>\n        </div>\n        \n        <div className=\"space-y-6\">\n          <h1 className=\"text-4xl font-bold text-white leading-tight\">\n            Moteur d'IA Contextuelle\n            <br />\n            Multi-Verticales\n          </h1>\n          <p className=\"text-primary-100 text-lg max-w-md\">\n            Propulsez votre expertise avec une intelligence artificielle qui comprend \n            votre métier et vos documents.\n          </p>\n        </div>\n\n        <div className=\"text-primary-200 text-sm\">\n          © 2025 Core RAG Engine. Tous droits réservés.\n        </div>\n      </div>\n\n      {/* Panneau droit - Formulaire */}\n      <div className=\"w-full lg:w-1/2 flex items-center justify-center p-8\">\n        <div className=\"w-full max-w-md\">\n          {/* Header mobile */}\n          <div className=\"lg:hidden flex items-center gap-3 mb-8\">\n            <div className=\"w-10 h-10 bg-primary-600 rounded-lg flex items-center justify-center\">\n              <Sparkles className=\"w-6 h-6 text-white\" />\n            </div>\n            <span className=\"text-2xl font-bold text-secondary-900\">Core RAG</span>\n          </div>\n\n          {/* Titre */}\n          <div className=\"mb-8\">\n            <h2 className=\"text-2xl font-bold text-secondary-900\">\n              {isResetPassword \n                ? 'Réinitialiser le mot de passe' \n                : isSignUp \n                  ? 'Créer un compte' \n                  : 'Bienvenue'}\n            </h2>\n            <p className=\"text-secondary-600 mt-2\">\n              {isResetPassword\n                ? 'Saisissez votre adresse email et nous vous enverrons un lien pour réinitialiser votre mot de passe.'\n                : isSignUp \n                  ? 'Commencez votre essai gratuit dès aujourd\\'hui.' \n                  : 'Connectez-vous pour accéder à votre espace.'}\n            </p>\n          </div>\n\n          {/* Message de succès */}\n          {successMessage && (\n            <div className=\"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3\">\n              <div className=\"w-5 h-5 rounded-full bg-green-500 flex items-center justify-center flex-shrink-0 mt-0.5\">\n                <svg className=\"w-3 h-3 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                </svg>\n              </div>\n              <p className=\"text-green-800 text-sm\">{successMessage}</p>\n            </div>\n          )}\n\n          {/* Message d'erreur */}\n          {(formError || error) && !isRedirecting && (\n            <div className=\"mb-6 p-4 bg-red-50 border-2 border-red-300 rounded-lg flex items-start gap-3 shadow-md\" role=\"alert\">\n              <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n              <div className=\"flex-1\">\n                <p className=\"text-red-900 text-sm font-semibold mb-1\">Erreur</p>\n                <p className=\"text-red-800 text-sm\">{formError || error}</p>\n              </div>\n            </div>\n          )}\n\n          {/* Écran de chargement plein écran pendant la redirection */}\n          {isRedirecting && (\n            <div className=\"fixed inset-0 bg-white z-50 flex items-center justify-center\">\n              <div className=\"text-center\">\n                <Loader2 className=\"w-16 h-16 animate-spin text-primary-600 mx-auto mb-4\" />\n                <p className=\"text-secondary-900 text-lg font-semibold\">Connexion réussie !</p>\n                <p className=\"text-secondary-600 text-sm mt-2\">Redirection en cours...</p>\n              </div>\n            </div>\n          )}\n\n          {/* Bouton Google (masqué en mode réinitialisation ou redirection) */}\n          {!isResetPassword && !isRedirecting && (\n            <>\n              <button\n                type=\"button\"\n                onClick={handleGoogleSignIn}\n                disabled={loading}\n                className=\"w-full flex items-center justify-center gap-3 px-4 py-3 border border-secondary-300 rounded-lg text-secondary-700 font-medium hover:bg-secondary-50 transition-colors disabled:opacity-50\"\n              >\n                <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n                  <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n                  <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n                  <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n                  <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n                </svg>\n                Continuer avec Google\n              </button>\n\n              {/* Séparateur */}\n              <div className=\"relative my-6\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <div className=\"w-full border-t border-secondary-200\"></div>\n                </div>\n                <div className=\"relative flex justify-center text-sm\">\n                  <span className=\"px-4 bg-secondary-50 text-secondary-500\">ou</span>\n                </div>\n              </div>\n            </>\n          )}\n\n          {/* Formulaire de réinitialisation de mot de passe */}\n          {!isRedirecting && isResetPassword ? (\n            <form onSubmit={handleResetPassword} className=\"space-y-4\">\n              <div>\n                <label htmlFor=\"resetEmail\" className=\"label\">\n                  Adresse email\n                </label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400\" />\n                  <input\n                    id=\"resetEmail\"\n                    type=\"email\"\n                    value={resetEmail}\n                    onChange={(e) => setResetEmail(e.target.value)}\n                    className=\"input pl-10\"\n                    placeholder=\"vous@exemple.com\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <button\n                type=\"submit\"\n                disabled={loading || isSubmitting}\n                className=\"btn-primary w-full py-3\"\n              >\n                {loading || isSubmitting ? (\n                  <>\n                    <Loader2 className=\"w-5 h-5 animate-spin mr-2\" />\n                    Envoi en cours...\n                  </>\n                ) : (\n                  'Envoyer l\\'email de réinitialisation'\n                )}\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setIsResetPassword(false)\n                  setResetEmail('')\n                  setFormError('')\n                  setSuccessMessage('')\n                  clearError()\n                }}\n                className=\"w-full text-center text-sm text-secondary-600 hover:text-secondary-700 font-medium\"\n              >\n                Retour à la connexion\n              </button>\n            </form>\n          ) : !isRedirecting ? (\n            /* Formulaire de connexion/inscription */\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              {/* Nom complet (inscription uniquement) */}\n              {isSignUp && (\n                <div>\n                  <label htmlFor=\"fullName\" className=\"label\">\n                    Nom complet\n                  </label>\n                  <div className=\"relative\">\n                    <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400\" />\n                    <input\n                      id=\"fullName\"\n                      type=\"text\"\n                      value={fullName}\n                      onChange={(e) => setFullName(e.target.value)}\n                      className=\"input pl-10\"\n                      placeholder=\"Jean Dupont\"\n                    />\n                  </div>\n                </div>\n              )}\n\n              {/* Email */}\n              <div>\n                <label htmlFor=\"email\" className=\"label\">\n                  Adresse email\n                </label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400\" />\n                  <input\n                    id=\"email\"\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    className=\"input pl-10\"\n                    placeholder=\"vous@exemple.com\"\n                    required\n                  />\n                </div>\n              </div>\n\n              {/* Mot de passe */}\n              <div>\n                <label htmlFor=\"password\" className=\"label\">\n                  Mot de passe\n                </label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400\" />\n                  <input\n                    id=\"password\"\n                    type={showPassword ? 'text' : 'password'}\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    className=\"input pl-10 pr-10\"\n                    placeholder=\"••••••••\"\n                    required\n                    minLength={6}\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"absolute right-3 top-1/2 -translate-y-1/2 text-secondary-400 hover:text-secondary-600\"\n                  >\n                    {showPassword ? (\n                      <EyeOff className=\"w-5 h-5\" />\n                    ) : (\n                      <Eye className=\"w-5 h-5\" />\n                    )}\n                  </button>\n                </div>\n                {/* Lien mot de passe oublié (connexion uniquement) */}\n                {!isSignUp && (\n                  <div className=\"mt-2 text-right\">\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        setIsResetPassword(true)\n                        setFormError('')\n                        setSuccessMessage('')\n                        clearError()\n                      }}\n                      className=\"text-sm text-primary-600 hover:text-primary-700 font-medium\"\n                    >\n                      Mot de passe oublié ?\n                    </button>\n                  </div>\n                )}\n              </div>\n\n              {/* Bouton submit */}\n              <button\n                type=\"submit\"\n                disabled={loading || isSubmitting}\n                className=\"btn-primary w-full py-3\"\n              >\n                {loading || isSubmitting ? (\n                  <>\n                    <Loader2 className=\"w-5 h-5 animate-spin mr-2\" />\n                    Chargement...\n                  </>\n                ) : isSignUp ? (\n                  'Créer mon compte'\n                ) : (\n                  'Se connecter'\n                )}\n              </button>\n            </form>\n          ) : null}\n\n          {/* Toggle Connexion/Inscription (masqué en mode réinitialisation ou redirection) */}\n          {!isResetPassword && !isRedirecting && (\n            <p className=\"mt-6 text-center text-secondary-600\">\n              {isSignUp ? 'Déjà un compte ?' : 'Pas encore de compte ?'}{' '}\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setIsSignUp(!isSignUp)\n                  setFormError('')\n                  setSuccessMessage('')\n                  setEmail('')\n                  setPassword('')\n                  setFullName('')\n                  setShowPassword(false)\n                  if (clearError) {\n                    clearError()\n                  }\n                }}\n                className=\"link\"\n              >\n                {isSignUp ? 'Se connecter' : 'S\\'inscrire'}\n              </button>\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n",
    "src/pages/Dashboard.jsx": "/**\n * Page Dashboard - Core RAG Engine\n * ============================================================================\n * Page principale après onboarding.\n * Affiche les informations de l'utilisateur et de son organisation.\n * \n * Pour la Brique 1, c'est une page de validation montrant:\n * - Profil utilisateur\n * - Organisation créée automatiquement\n * - Crédits disponibles\n * ============================================================================\n */\n\nimport { useState } from 'react'\nimport { useAuth } from '../contexts/AuthContext'\nimport { callRagBrain } from '../lib/supabaseClient'\nimport UserMenu from '../components/UserMenu'\nimport { \n  Sparkles,\n  Settings,\n  Paperclip,\n  Mic,\n  Send,\n  Calendar,\n  Briefcase,\n  Loader2,\n  AlertCircle\n} from 'lucide-react'\n\nexport default function Dashboard() {\n  const { \n    user, \n    profile, \n    organization, \n    signOut\n  } = useAuth()\n\n  const [activeTab, setActiveTab] = useState('assistant')\n  const [message, setMessage] = useState('')\n  const [isLoadingRag, setIsLoadingRag] = useState(false)\n  const [conversationHistory, setConversationHistory] = useState([])\n  const [ragError, setRagError] = useState(null)\n  const [verticalIdWarning, setVerticalIdWarning] = useState(false)\n\n  const handleSignOut = async () => {\n    await signOut()\n  }\n\n  const handleSendMessage = async (e) => {\n    e?.preventDefault()\n    \n    if (!message.trim() || isLoadingRag) return\n    \n    setIsLoadingRag(true)\n    setRagError(null)\n    setVerticalIdWarning(false)\n    \n    // Ajouter le message utilisateur à l'historique\n    const userMessage = { \n      role: 'user', \n      content: message, \n      timestamp: new Date() \n    }\n    setConversationHistory(prev => [...prev, userMessage])\n    \n    const currentMessage = message\n    setMessage('') // Vider le champ immédiatement\n    \n    try {\n      // Utiliser une valeur par défaut temporaire avec avertissement\n      const verticalId = organization?.vertical_id || profile?.vertical_id || 'default-vertical-id'\n      \n      if (verticalId === 'default-vertical-id') {\n        setVerticalIdWarning(true)\n        console.warn('⚠️ vertical_id non configuré, utilisation d\\'une valeur par défaut temporaire')\n      }\n      \n      const { data, error } = await callRagBrain(currentMessage, verticalId, {\n        matchThreshold: 0.5,\n        matchCount: 5\n      })\n      \n      if (error) {\n        setRagError(error.message || 'Une erreur est survenue lors de la requête RAG')\n        console.error('Erreur RAG:', error)\n      } else {\n        // Ajouter la réponse à l'historique selon le format de votre Edge Function\n        const assistantMessage = { \n          role: 'assistant', \n          content: data.answer, \n          sources: data.sources || [],\n          processingTime: data.processingTime,\n          timestamp: new Date() \n        }\n        setConversationHistory(prev => [...prev, assistantMessage])\n      }\n    } catch (err) {\n      setRagError(err.message || 'Une erreur inattendue s\\'est produite')\n      console.error('Erreur:', err)\n    } finally {\n      setIsLoadingRag(false)\n    }\n  }\n\n  const getGreeting = () => {\n    const hour = new Date().getHours()\n    if (hour < 12) return 'Bonjour'\n    if (hour < 18) return 'Bon après-midi'\n    return 'Bonsoir'\n  }\n\n  return (\n    <div className=\"min-h-screen bg-secondary-50\">\n      {/* Header avec navigation */}\n      <header className=\"bg-white border-b border-secondary-200\">\n        <div className=\"max-w-full mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            {/* Logo et compteur */}\n            <div className=\"flex items-center gap-6\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-9 h-9 bg-primary-600 rounded-lg flex items-center justify-center\">\n                  <Sparkles className=\"w-5 h-5 text-white\" />\n                </div>\n                <span className=\"text-xl font-bold text-secondary-900\">Core RAG</span>\n              </div>\n              \n              {/* Compteur */}\n              <div className=\"text-sm text-secondary-500\">\n                {conversationHistory.length}/10\n              </div>\n\n              {/* Navigation tabs */}\n              <nav className=\"flex items-center gap-1\">\n                <button\n                  onClick={() => setActiveTab('assistant')}\n                  className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${\n                    activeTab === 'assistant'\n                      ? 'bg-secondary-100 text-secondary-900'\n                      : 'text-secondary-500 hover:text-secondary-700 hover:bg-secondary-50'\n                  }`}\n                >\n                  Assistant\n                </button>\n                <button\n                  onClick={() => setActiveTab('documents')}\n                  className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${\n                    activeTab === 'documents'\n                      ? 'bg-secondary-100 text-secondary-900'\n                      : 'text-secondary-500 hover:text-secondary-700 hover:bg-secondary-50'\n                  }`}\n                >\n                  Documents\n                </button>\n                <button\n                  onClick={() => setActiveTab('bibliotheque')}\n                  className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${\n                    activeTab === 'bibliotheque'\n                      ? 'bg-secondary-100 text-secondary-900'\n                      : 'text-secondary-500 hover:text-secondary-700 hover:bg-secondary-50'\n                  }`}\n                >\n                  Bibliothèque\n                </button>\n              </nav>\n            </div>\n\n            {/* Actions droite */}\n            <div className=\"flex items-center gap-2\">\n              <button className=\"p-2 text-secondary-500 hover:text-secondary-700 hover:bg-secondary-100 rounded-lg transition-colors\">\n                <Settings className=\"w-5 h-5\" />\n              </button>\n              \n              {/* User menu */}\n              <UserMenu \n                user={user}\n                profile={profile}\n                organization={organization}\n                onSignOut={handleSignOut}\n              />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Zone principale avec message de bienvenue */}\n        <div className=\"max-w-5xl mx-auto\">\n          {/* Message de bienvenue */}\n          <div className=\"mb-8\">\n            <h1 className=\"text-5xl font-bold text-secondary-900 mb-4\">\n              {getGreeting()} {profile?.full_name?.split(' ')[0] || 'Eric'},\n            </h1>\n            \n            {/* Graphique décoratif */}\n            <div className=\"relative w-full h-32 mb-6 overflow-hidden\">\n              <svg className=\"absolute inset-0 w-full h-full\" viewBox=\"0 0 1200 200\" preserveAspectRatio=\"none\">\n                <defs>\n                  <linearGradient id=\"waveGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                    <stop offset=\"0%\" stopColor=\"#3b82f6\" stopOpacity=\"0.3\" />\n                    <stop offset=\"50%\" stopColor=\"#8b5cf6\" stopOpacity=\"0.2\" />\n                    <stop offset=\"100%\" stopColor=\"#3b82f6\" stopOpacity=\"0.3\" />\n                  </linearGradient>\n                </defs>\n                <path\n                  d=\"M0,100 Q300,50 600,100 T1200,100 L1200,200 L0,200 Z\"\n                  fill=\"url(#waveGradient)\"\n                />\n                <path\n                  d=\"M0,120 Q400,80 800,120 T1200,120 L1200,200 L0,200 Z\"\n                  fill=\"url(#waveGradient)\"\n                  opacity=\"0.5\"\n                />\n              </svg>\n            </div>\n\n            {/* Bouton Effacer l'historique */}\n            <div className=\"flex justify-end mb-6\">\n              {conversationHistory.length > 0 && (\n                <button \n                  onClick={() => {\n                    setConversationHistory([])\n                    setRagError(null)\n                    setVerticalIdWarning(false)\n                  }}\n                  className=\"flex items-center gap-2 px-4 py-2 bg-secondary-100 text-secondary-700 rounded-lg hover:bg-secondary-200 transition-colors\"\n                >\n                  <Briefcase className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\">Effacer l'historique</span>\n                </button>\n              )}\n            </div>\n          </div>\n\n          {/* Avertissement vertical_id */}\n          {verticalIdWarning && (\n            <div className=\"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-3\">\n              <AlertCircle className=\"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5\" />\n              <div className=\"flex-1\">\n                <p className=\"text-amber-900 text-sm font-semibold mb-1\">Configuration requise</p>\n                <p className=\"text-amber-800 text-sm\">\n                  Aucune verticale configurée. Veuillez configurer un <code className=\"bg-amber-100 px-1 rounded\">vertical_id</code> dans les paramètres de votre organisation pour utiliser le RAG correctement.\n                </p>\n              </div>\n              <button\n                onClick={() => setVerticalIdWarning(false)}\n                className=\"text-amber-600 hover:text-amber-800\"\n              >\n                ×\n              </button>\n            </div>\n          )}\n\n          {/* Historique de conversation */}\n          {conversationHistory.length > 0 && (\n            <div className=\"mb-6 space-y-4 max-h-96 overflow-y-auto\">\n              {conversationHistory.map((msg, idx) => (\n                <div \n                  key={idx} \n                  className={`p-4 rounded-lg ${\n                    msg.role === 'user' \n                      ? 'bg-primary-50 text-primary-900 ml-8 border border-primary-200' \n                      : 'bg-secondary-100 text-secondary-900 mr-8 border border-secondary-200'\n                  }`}\n                >\n                  <div className=\"flex items-start gap-2\">\n                    <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-semibold ${\n                      msg.role === 'user' ? 'bg-primary-600 text-white' : 'bg-secondary-600 text-white'\n                    }`}>\n                      {msg.role === 'user' ? 'U' : 'AI'}\n                    </div>\n                    <div className=\"flex-1\">\n                      <p className=\"text-sm whitespace-pre-wrap\">{msg.content}</p>\n                      \n                      {/* Afficher les sources si disponibles */}\n                      {msg.sources && msg.sources.length > 0 && (\n                        <div className=\"mt-3 pt-3 border-t border-secondary-200\">\n                          <p className=\"text-xs font-semibold text-secondary-600 mb-2\">\n                            📚 {msg.sources.length} source{msg.sources.length > 1 ? 's' : ''} utilisée{msg.sources.length > 1 ? 's' : ''}:\n                          </p>\n                          <div className=\"space-y-2\">\n                            {msg.sources.map((source, sourceIdx) => (\n                              <div \n                                key={sourceIdx} \n                                className=\"p-2 bg-white rounded border border-secondary-200 text-xs\"\n                              >\n                                <div className=\"flex items-center justify-between mb-1\">\n                                  <span className=\"font-medium text-secondary-700\">\n                                    Source {sourceIdx + 1}\n                                  </span>\n                                  {source.similarity && (\n                                    <span className=\"text-secondary-500\">\n                                      {Math.round(source.similarity * 100)}% de similarité\n                                    </span>\n                                  )}\n                                </div>\n                                <p className=\"text-secondary-600 line-clamp-2\">\n                                  {source.content || 'Aucun aperçu disponible'}\n                                </p>\n                                {source.metadata && Object.keys(source.metadata).length > 0 && (\n                                  <div className=\"mt-1 text-secondary-400 text-xs\">\n                                    {JSON.stringify(source.metadata)}\n                                  </div>\n                                )}\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                      \n                      {/* Afficher le temps de traitement si disponible */}\n                      {msg.processingTime && (\n                        <p className=\"mt-2 text-xs text-secondary-400\">\n                          ⏱️ Traité en {msg.processingTime}ms\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n\n          {/* Zone de saisie pour l'assistant */}\n          <div className=\"relative\">\n            <div className=\"bg-white rounded-2xl shadow-lg border border-secondary-200 p-4\">\n              <div className=\"flex items-center gap-3 mb-3\">\n                <button className=\"p-2 text-secondary-400 hover:text-secondary-600 hover:bg-secondary-50 rounded-lg transition-colors\">\n                  <Paperclip className=\"w-5 h-5\" />\n                </button>\n                <input\n                  type=\"text\"\n                  value={message}\n                  onChange={(e) => setMessage(e.target.value)}\n                  placeholder=\"Dites-moi ce dont vous avez besoin...... (@ pour mentionner un document)\"\n                  className=\"flex-1 px-4 py-2 text-secondary-900 placeholder-secondary-400 focus:outline-none\"\n                />\n                <button className=\"p-2 text-secondary-400 hover:text-secondary-600 hover:bg-secondary-50 rounded-lg transition-colors\">\n                  <Mic className=\"w-5 h-5\" />\n                </button>\n                <button className=\"p-2 bg-secondary-900 text-white rounded-full hover:bg-secondary-800 transition-colors\">\n                  <Send className=\"w-5 h-5\" />\n                </button>\n              </div>\n              \n              {/* Informations en bas du champ */}\n              <div className=\"flex items-center justify-between pt-3 border-t border-secondary-100\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"px-3 py-1 bg-secondary-100 text-secondary-600 text-xs rounded-full\">\n                    EUFR 12 sources\n                  </span>\n                  <button className=\"flex items-center gap-1 px-3 py-1 bg-secondary-100 text-secondary-600 text-xs rounded-full hover:bg-secondary-200 transition-colors\">\n                    <Calendar className=\"w-3 h-3\" />\n                    <span>26/11/2025</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Message footer */}\n          <div className=\"mt-8 text-center\">\n            <p className=\"text-sm text-secondary-500\">\n              Vous êtes sur notre version gratuite.{' '}\n              <button className=\"text-primary-600 hover:text-primary-700 font-medium\">\n                Passez PRO\n              </button>\n            </p>\n          </div>\n        </div>\n      </main>\n    </div>\n  )\n}\n",
    "src/pages/Settings.jsx": "import { useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { useAuth } from '../contexts/AuthContext'\nimport { \n  ArrowLeft,\n  User,\n  Mail,\n  Building2,\n  Shield,\n  Globe,\n  Moon,\n  Sun,\n  Bell,\n  Lock,\n  Sparkles\n} from 'lucide-react'\n\nexport default function Settings() {\n  const navigate = useNavigate()\n  const { user, profile, organization, signOut } = useAuth()\n  const [darkMode, setDarkMode] = useState(false)\n  const [language, setLanguage] = useState('fr')\n  const [notifications, setNotifications] = useState(true)\n\n  const handleSignOut = async () => {\n    await signOut()\n  }\n\n  return (\n    <div className=\"min-h-screen bg-secondary-50\">\n      {/* Header */}\n      <header className=\"bg-white border-b border-secondary-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center h-16\">\n            <button\n              onClick={() => navigate('/dashboard')}\n              className=\"flex items-center gap-2 text-secondary-600 hover:text-secondary-900 transition-colors\"\n            >\n              <ArrowLeft className=\"w-5 h-5\" />\n              <span>Retour</span>\n            </button>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Titre */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"w-10 h-10 bg-primary-600 rounded-lg flex items-center justify-center\">\n              <Sparkles className=\"w-6 h-6 text-white\" />\n            </div>\n            <h1 className=\"text-3xl font-bold text-secondary-900\">Paramètres</h1>\n          </div>\n          <p className=\"text-secondary-600\">Gérez les paramètres de votre compte et de votre organisation</p>\n        </div>\n\n        {/* Sections */}\n        <div className=\"space-y-6\">\n          {/* Informations personnelles */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-secondary-200 p-6\">\n            <h2 className=\"text-lg font-semibold text-secondary-900 mb-4 flex items-center gap-2\">\n              <User className=\"w-5 h-5 text-secondary-500\" />\n              Informations personnelles\n            </h2>\n            <dl className=\"space-y-4\">\n              <div className=\"flex justify-between items-center py-2 border-b border-secondary-100\">\n                <dt className=\"text-secondary-500\">Nom complet</dt>\n                <dd className=\"text-secondary-900 font-medium\">\n                  {profile?.full_name || '-'}\n                </dd>\n              </div>\n              <div className=\"flex justify-between items-center py-2 border-b border-secondary-100\">\n                <dt className=\"text-secondary-500\">Email</dt>\n                <dd className=\"text-secondary-900\">{user?.email}</dd>\n              </div>\n              <div className=\"flex justify-between items-center py-2\">\n                <dt className=\"text-secondary-500\">Rôle</dt>\n                <dd className=\"text-secondary-900 capitalize\">\n                  {profile?.business_role || '-'}\n                </dd>\n              </div>\n            </dl>\n            <button className=\"mt-4 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors\">\n              Modifier le profil\n            </button>\n          </div>\n\n          {/* Organisation */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-secondary-200 p-6\">\n            <h2 className=\"text-lg font-semibold text-secondary-900 mb-4 flex items-center gap-2\">\n              <Building2 className=\"w-5 h-5 text-secondary-500\" />\n              Organisation\n            </h2>\n            <dl className=\"space-y-4\">\n              <div className=\"flex justify-between items-center py-2 border-b border-secondary-100\">\n                <dt className=\"text-secondary-500\">Nom</dt>\n                <dd className=\"text-secondary-900 font-medium\">\n                  {organization?.name || '-'}\n                </dd>\n              </div>\n              <div className=\"flex justify-between items-center py-2 border-b border-secondary-100\">\n                <dt className=\"text-secondary-500\">Plan</dt>\n                <dd className=\"text-secondary-900 capitalize\">\n                  {organization?.plan || 'free'}\n                </dd>\n              </div>\n              <div className=\"flex justify-between items-center py-2\">\n                <dt className=\"text-secondary-500\">Crédits disponibles</dt>\n                <dd className=\"text-secondary-900 font-semibold\">\n                  {organization?.credits_balance ?? 0}\n                </dd>\n              </div>\n            </dl>\n            <button className=\"mt-4 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors\">\n              Gérer l'organisation\n            </button>\n          </div>\n\n          {/* Sécurité */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-secondary-200 p-6\">\n            <h2 className=\"text-lg font-semibold text-secondary-900 mb-4 flex items-center gap-2\">\n              <Lock className=\"w-5 h-5 text-secondary-500\" />\n              Sécurité\n            </h2>\n            <div className=\"space-y-4\">\n              <button className=\"w-full flex items-center justify-between p-4 border border-secondary-200 rounded-lg hover:bg-secondary-50 transition-colors\">\n                <div className=\"flex items-center gap-3\">\n                  <Lock className=\"w-5 h-5 text-secondary-500\" />\n                  <div className=\"text-left\">\n                    <p className=\"font-medium text-secondary-900\">Changer le mot de passe</p>\n                    <p className=\"text-sm text-secondary-500\">Mettez à jour votre mot de passe régulièrement</p>\n                  </div>\n                </div>\n                <span className=\"text-secondary-400\">→</span>\n              </button>\n            </div>\n          </div>\n\n          {/* Préférences */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-secondary-200 p-6\">\n            <h2 className=\"text-lg font-semibold text-secondary-900 mb-4 flex items-center gap-2\">\n              <Bell className=\"w-5 h-5 text-secondary-500\" />\n              Préférences\n            </h2>\n            <div className=\"space-y-4\">\n              {/* Mode sombre */}\n              <div className=\"flex items-center justify-between py-2\">\n                <div className=\"flex items-center gap-3\">\n                  {darkMode ? (\n                    <Moon className=\"w-5 h-5 text-secondary-500\" />\n                  ) : (\n                    <Sun className=\"w-5 h-5 text-secondary-500\" />\n                  )}\n                  <div>\n                    <p className=\"font-medium text-secondary-900\">Mode sombre</p>\n                    <p className=\"text-sm text-secondary-500\">Activer le thème sombre</p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => setDarkMode(!darkMode)}\n                  className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                    darkMode ? 'bg-primary-600' : 'bg-secondary-300'\n                  }`}\n                >\n                  <span\n                    className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                      darkMode ? 'translate-x-6' : 'translate-x-1'\n                    }`}\n                  />\n                </button>\n              </div>\n\n              {/* Notifications */}\n              <div className=\"flex items-center justify-between py-2\">\n                <div className=\"flex items-center gap-3\">\n                  <Bell className=\"w-5 h-5 text-secondary-500\" />\n                  <div>\n                    <p className=\"font-medium text-secondary-900\">Notifications</p>\n                    <p className=\"text-sm text-secondary-500\">Recevoir des notifications par email</p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => setNotifications(!notifications)}\n                  className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                    notifications ? 'bg-primary-600' : 'bg-secondary-300'\n                  }`}\n                >\n                  <span\n                    className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                      notifications ? 'translate-x-6' : 'translate-x-1'\n                    }`}\n                  />\n                </button>\n              </div>\n\n              {/* Langue */}\n              <div className=\"py-2\">\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <Globe className=\"w-5 h-5 text-secondary-500\" />\n                  <div>\n                    <p className=\"font-medium text-secondary-900\">Langue</p>\n                    <p className=\"text-sm text-secondary-500\">Sélectionnez votre langue préférée</p>\n                  </div>\n                </div>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setLanguage('fr')}\n                    className={`px-4 py-2 rounded-lg transition-colors ${\n                      language === 'fr'\n                        ? 'bg-primary-600 text-white'\n                        : 'bg-secondary-100 text-secondary-700 hover:bg-secondary-200'\n                    }`}\n                  >\n                    Français FR\n                  </button>\n                  <button\n                    onClick={() => setLanguage('en')}\n                    className={`px-4 py-2 rounded-lg transition-colors ${\n                      language === 'en'\n                        ? 'bg-primary-600 text-white'\n                        : 'bg-secondary-100 text-secondary-700 hover:bg-secondary-200'\n                    }`}\n                  >\n                    English GB\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Zone de danger */}\n          <div className=\"bg-red-50 rounded-xl shadow-sm border border-red-200 p-6\">\n            <h2 className=\"text-lg font-semibold text-red-900 mb-4\">Zone de danger</h2>\n            <p className=\"text-red-700 mb-4\">\n              Les actions ci-dessous sont irréversibles. Veuillez agir avec prudence.\n            </p>\n            <button\n              onClick={handleSignOut}\n              className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\"\n            >\n              Se déconnecter\n            </button>\n          </div>\n        </div>\n      </main>\n    </div>\n  )\n}\n\n",
    "src/pages/ResetPassword.jsx": "/**\n * Page ResetPassword - Core RAG Engine\n * ============================================================================\n * Page de réinitialisation de mot de passe après clic sur le lien email\n * ============================================================================\n */\n\nimport { useState, useEffect } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { useAuth } from '../contexts/AuthContext'\nimport { supabase } from '../lib/supabaseClient'\nimport { \n  Lock, \n  Eye, \n  EyeOff, \n  Loader2,\n  AlertCircle,\n  CheckCircle2,\n  Sparkles\n} from 'lucide-react'\n\nexport default function ResetPassword() {\n  const [newPassword, setNewPassword] = useState('')\n  const [confirmPassword, setConfirmPassword] = useState('')\n  const [showPassword, setShowPassword] = useState(false)\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false)\n  const [formError, setFormError] = useState('')\n  const [successMessage, setSuccessMessage] = useState('')\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [isValidToken, setIsValidToken] = useState(false)\n  const [isCheckingToken, setIsCheckingToken] = useState(true)\n  const navigate = useNavigate()\n\n  const { updatePassword, loading, error, clearError } = useAuth()\n\n  useEffect(() => {\n    const checkToken = async () => {\n      setIsCheckingToken(true)\n      \n      try {\n        const hash = window.location.hash\n        const hashParams = new URLSearchParams(hash.substring(1))\n        const type = hashParams.get('type')\n        const accessToken = hashParams.get('access_token')\n        \n        if (type === 'recovery' && accessToken) {\n          setTimeout(async () => {\n            const { data: { session: currentSession } } = await supabase.auth.getSession()\n            if (currentSession) {\n              setIsValidToken(true)\n              window.history.replaceState(null, '', window.location.pathname)\n            } else {\n              setFormError('Lien de réinitialisation invalide ou expiré.')\n            }\n            setIsCheckingToken(false)\n          }, 500)\n        } else {\n          const { data: { session: currentSession } } = await supabase.auth.getSession()\n          if (currentSession) {\n            setIsValidToken(true)\n          } else {\n            setFormError('Lien de réinitialisation invalide ou expiré.')\n          }\n          setIsCheckingToken(false)\n        }\n      } catch (err) {\n        setFormError('Lien de réinitialisation invalide ou expiré.')\n        setIsCheckingToken(false)\n      }\n    }\n\n    checkToken()\n  }, [])\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    \n    if (isSubmitting) {\n      return\n    }\n    \n    setIsSubmitting(true)\n    setFormError('')\n    setSuccessMessage('')\n    clearError()\n\n    if (!newPassword || !confirmPassword) {\n      setFormError('Veuillez remplir tous les champs.')\n      setIsSubmitting(false)\n      return\n    }\n\n    if (newPassword.length < 6) {\n      setFormError('Le mot de passe doit contenir au moins 6 caractères.')\n      setIsSubmitting(false)\n      return\n    }\n\n    if (newPassword !== confirmPassword) {\n      setFormError('Les mots de passe ne correspondent pas.')\n      setIsSubmitting(false)\n      return\n    }\n\n    try {\n      const { error } = await updatePassword(newPassword)\n      \n      if (error) {\n        setFormError(error.message || 'Une erreur est survenue lors de la mise à jour du mot de passe.')\n      } else {\n        setSuccessMessage('Votre mot de passe a été mis à jour avec succès !')\n        // Rediriger vers le login après 2 secondes\n        setTimeout(() => {\n          navigate('/login')\n        }, 2000)\n      }\n    } catch (err) {\n      setFormError(err?.message || 'Une erreur inattendue s\\'est produite.')\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex bg-pattern\">\n      {/* Panneau gauche - Branding */}\n      <div className=\"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary-600 to-primary-800 p-12 flex-col justify-between\">\n        <div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center\">\n              <Sparkles className=\"w-6 h-6 text-white\" />\n            </div>\n            <span className=\"text-2xl font-bold text-white\">Core RAG</span>\n          </div>\n        </div>\n        \n        <div className=\"space-y-6\">\n          <h1 className=\"text-4xl font-bold text-white leading-tight\">\n            Réinitialisation\n            <br />\n            de mot de passe\n          </h1>\n          <p className=\"text-primary-100 text-lg max-w-md\">\n            Définissez un nouveau mot de passe sécurisé pour accéder à votre compte.\n          </p>\n        </div>\n\n        <div className=\"text-primary-200 text-sm\">\n          © 2025 Core RAG Engine. Tous droits réservés.\n        </div>\n      </div>\n\n      {/* Panneau droit - Formulaire */}\n      <div className=\"w-full lg:w-1/2 flex items-center justify-center p-8\">\n        <div className=\"w-full max-w-md\">\n          {/* Header mobile */}\n          <div className=\"lg:hidden flex items-center gap-3 mb-8\">\n            <div className=\"w-10 h-10 bg-primary-600 rounded-lg flex items-center justify-center\">\n              <Sparkles className=\"w-6 h-6 text-white\" />\n            </div>\n            <span className=\"text-2xl font-bold text-secondary-900\">Core RAG</span>\n          </div>\n\n          {/* Titre */}\n          <div className=\"mb-8\">\n            <h2 className=\"text-2xl font-bold text-secondary-900\">\n              Nouveau mot de passe\n            </h2>\n            <p className=\"text-secondary-600 mt-2\">\n              Saisissez votre nouveau mot de passe ci-dessous.\n            </p>\n          </div>\n\n          {/* Message de succès */}\n          {successMessage && (\n            <div className=\"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3\">\n              <CheckCircle2 className=\"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5\" />\n              <p className=\"text-green-800 text-sm\">{successMessage}</p>\n            </div>\n          )}\n\n          {/* Message d'erreur */}\n          {(formError || error) && (\n            <div className=\"mb-6 p-4 bg-red-50 border-2 border-red-300 rounded-lg flex items-start gap-3 shadow-md\" role=\"alert\">\n              <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n              <div className=\"flex-1\">\n                <p className=\"text-red-900 text-sm font-semibold mb-1\">Erreur</p>\n                <p className=\"text-red-800 text-sm\">{formError || error}</p>\n              </div>\n            </div>\n          )}\n\n          {/* Chargement de la vérification du token */}\n          {isCheckingToken && (\n            <div className=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-center gap-3\">\n              <Loader2 className=\"w-5 h-5 text-blue-600 animate-spin\" />\n              <p className=\"text-blue-800 text-sm\">Vérification du lien de réinitialisation...</p>\n            </div>\n          )}\n\n          {/* Formulaire */}\n          {!isCheckingToken && isValidToken && (\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {/* Nouveau mot de passe */}\n            <div>\n              <label htmlFor=\"newPassword\" className=\"label\">\n                Nouveau mot de passe\n              </label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400\" />\n                <input\n                  id=\"newPassword\"\n                  type={showPassword ? 'text' : 'password'}\n                  value={newPassword}\n                  onChange={(e) => setNewPassword(e.target.value)}\n                  className=\"input pl-10 pr-10\"\n                  placeholder=\"••••••••\"\n                  required\n                  minLength={6}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-secondary-400 hover:text-secondary-600\"\n                >\n                  {showPassword ? (\n                    <EyeOff className=\"w-5 h-5\" />\n                  ) : (\n                    <Eye className=\"w-5 h-5\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Confirmation du mot de passe */}\n            <div>\n              <label htmlFor=\"confirmPassword\" className=\"label\">\n                Confirmer le mot de passe\n              </label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400\" />\n                <input\n                  id=\"confirmPassword\"\n                  type={showConfirmPassword ? 'text' : 'password'}\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  className=\"input pl-10 pr-10\"\n                  placeholder=\"••••••••\"\n                  required\n                  minLength={6}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-secondary-400 hover:text-secondary-600\"\n                >\n                  {showConfirmPassword ? (\n                    <EyeOff className=\"w-5 h-5\" />\n                  ) : (\n                    <Eye className=\"w-5 h-5\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Bouton submit */}\n            <button\n              type=\"submit\"\n              disabled={loading || isSubmitting}\n              className=\"btn-primary w-full py-3\"\n            >\n              {loading || isSubmitting ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin mr-2\" />\n                  Mise à jour...\n                </>\n              ) : (\n                'Mettre à jour le mot de passe'\n              )}\n            </button>\n          </form>\n          )}\n\n          {/* Lien retour */}\n          {!isCheckingToken && (\n            <p className=\"mt-6 text-center text-secondary-600\">\n              <button\n                type=\"button\"\n                onClick={() => navigate('/login')}\n                className=\"text-sm text-primary-600 hover:text-primary-700 font-medium\"\n              >\n                Retour à la connexion\n              </button>\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n",
    "src/pages/Onboarding.jsx": "/**\n * Page Onboarding - Core RAG Engine\n * ============================================================================\n * Page de qualification après inscription.\n * L'utilisateur choisit son rôle métier:\n * - \"provider\" (Expert/Prestataire)\n * - \"client\" (Client/Entreprise)\n * ============================================================================\n */\n\nimport { useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { useAuth } from '../contexts/AuthContext'\nimport { completeOnboarding } from '../lib/supabaseClient'\nimport { \n  Briefcase, \n  Building2, \n  Loader2, \n  ArrowRight,\n  Sparkles,\n  CheckCircle2\n} from 'lucide-react'\n\n// Configuration des rôles\nconst ROLES = [\n  {\n    id: 'provider',\n    title: 'Je suis Expert',\n    subtitle: 'Consultant, Auditeur, Avocat...',\n    description: 'J\\'utilise l\\'IA pour augmenter ma productivité et servir mes clients.',\n    icon: Briefcase,\n    color: 'primary',\n    features: [\n      'Créez votre base de connaissances',\n      'Automatisez vos analyses',\n      'Générez des rapports intelligents'\n    ]\n  },\n  {\n    id: 'client',\n    title: 'Je suis Client',\n    subtitle: 'Entreprise, PME, Organisation...',\n    description: 'Je cherche à exploiter l\\'IA pour améliorer mes processus internes.',\n    icon: Building2,\n    color: 'secondary',\n    features: [\n      'Centralisez vos documents',\n      'Posez des questions à votre data',\n      'Collaborez avec votre équipe'\n    ]\n  }\n]\n\nexport default function Onboarding() {\n  const navigate = useNavigate()\n  const { profile, refreshProfile } = useAuth()\n  \n  // États\n  const [selectedRole, setSelectedRole] = useState(null)\n  const [bio, setBio] = useState('')\n  const [step, setStep] = useState(1) // 1: Choix du rôle, 2: Bio optionnelle\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  /**\n   * Passer à l'étape suivante\n   */\n  const handleNext = () => {\n    if (!selectedRole) {\n      setError('Veuillez sélectionner un rôle pour continuer.')\n      return\n    }\n    setError('')\n    setStep(2)\n  }\n\n  /**\n   * Finaliser l'onboarding\n   */\n  const handleComplete = async () => {\n    if (!selectedRole) return\n\n    setLoading(true)\n    setError('')\n\n    try {\n      await completeOnboarding(selectedRole, bio || null)\n      await refreshProfile()\n      navigate('/dashboard')\n    } catch (err) {\n      setError('Une erreur est survenue. Veuillez réessayer.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  /**\n   * Passer la bio (optionnel)\n   */\n  const handleSkip = async () => {\n    setBio('')\n    await handleComplete()\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-secondary-50 to-primary-50 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-3xl\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-primary-100 text-primary-700 rounded-full text-sm font-medium mb-4\">\n            <Sparkles className=\"w-4 h-4\" />\n            Bienvenue sur Core RAG\n          </div>\n          <h1 className=\"text-3xl font-bold text-secondary-900\">\n            {step === 1 ? 'Comment utiliserez-vous la plateforme ?' : 'Parlez-nous de vous'}\n          </h1>\n          <p className=\"text-secondary-600 mt-2\">\n            {step === 1 \n              ? 'Cette information nous aide à personnaliser votre expérience.'\n              : 'Une courte description pour que les autres sachent qui vous êtes.'}\n          </p>\n        </div>\n\n        {/* Indicateur de progression */}\n        <div className=\"flex items-center justify-center gap-2 mb-8\">\n          <div className={`w-3 h-3 rounded-full ${step >= 1 ? 'bg-primary-600' : 'bg-secondary-300'}`} />\n          <div className={`w-12 h-1 rounded ${step >= 2 ? 'bg-primary-600' : 'bg-secondary-300'}`} />\n          <div className={`w-3 h-3 rounded-full ${step >= 2 ? 'bg-primary-600' : 'bg-secondary-300'}`} />\n        </div>\n\n        {/* Erreur */}\n        {error && (\n          <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-center\">\n            {error}\n          </div>\n        )}\n\n        {/* Étape 1: Choix du rôle */}\n        {step === 1 && (\n          <>\n            <div className=\"grid md:grid-cols-2 gap-6 mb-8\">\n              {ROLES.map((role) => {\n                const Icon = role.icon\n                const isSelected = selectedRole === role.id\n                \n                return (\n                  <button\n                    key={role.id}\n                    onClick={() => setSelectedRole(role.id)}\n                    className={`\n                      relative p-6 rounded-2xl border-2 text-left transition-all duration-200\n                      ${isSelected \n                        ? 'border-primary-500 bg-primary-50 shadow-lg shadow-primary-100' \n                        : 'border-secondary-200 bg-white hover:border-secondary-300 hover:shadow-md'\n                      }\n                    `}\n                  >\n                    {/* Icône de sélection */}\n                    {isSelected && (\n                      <div className=\"absolute top-4 right-4\">\n                        <CheckCircle2 className=\"w-6 h-6 text-primary-600\" />\n                      </div>\n                    )}\n\n                    {/* Icône du rôle */}\n                    <div className={`\n                      w-14 h-14 rounded-xl flex items-center justify-center mb-4\n                      ${isSelected ? 'bg-primary-600' : 'bg-secondary-100'}\n                    `}>\n                      <Icon className={`w-7 h-7 ${isSelected ? 'text-white' : 'text-secondary-600'}`} />\n                    </div>\n\n                    {/* Contenu */}\n                    <h3 className=\"text-xl font-semibold text-secondary-900 mb-1\">\n                      {role.title}\n                    </h3>\n                    <p className=\"text-sm text-secondary-500 mb-3\">\n                      {role.subtitle}\n                    </p>\n                    <p className=\"text-secondary-600 mb-4\">\n                      {role.description}\n                    </p>\n\n                    {/* Features */}\n                    <ul className=\"space-y-2\">\n                      {role.features.map((feature, index) => (\n                        <li key={index} className=\"flex items-center gap-2 text-sm text-secondary-600\">\n                          <div className={`w-1.5 h-1.5 rounded-full ${isSelected ? 'bg-primary-500' : 'bg-secondary-400'}`} />\n                          {feature}\n                        </li>\n                      ))}\n                    </ul>\n                  </button>\n                )\n              })}\n            </div>\n\n            {/* Bouton Continuer */}\n            <div className=\"flex justify-center\">\n              <button\n                onClick={handleNext}\n                disabled={!selectedRole}\n                className=\"btn-primary px-8 py-3 text-lg\"\n              >\n                Continuer\n                <ArrowRight className=\"w-5 h-5 ml-2\" />\n              </button>\n            </div>\n          </>\n        )}\n\n        {/* Étape 2: Bio optionnelle */}\n        {step === 2 && (\n          <div className=\"max-w-lg mx-auto\">\n            <div className=\"card\">\n              {/* Rôle sélectionné */}\n              <div className=\"flex items-center gap-3 p-4 bg-primary-50 rounded-lg mb-6\">\n                {ROLES.find(r => r.id === selectedRole)?.icon && (\n                  <div className=\"w-10 h-10 bg-primary-600 rounded-lg flex items-center justify-center\">\n                    {(() => {\n                      const Icon = ROLES.find(r => r.id === selectedRole)?.icon\n                      return Icon ? <Icon className=\"w-5 h-5 text-white\" /> : null\n                    })()}\n                  </div>\n                )}\n                <div>\n                  <p className=\"text-sm text-primary-600 font-medium\">Rôle sélectionné</p>\n                  <p className=\"text-secondary-900 font-semibold\">\n                    {ROLES.find(r => r.id === selectedRole)?.title}\n                  </p>\n                </div>\n              </div>\n\n              {/* Champ Bio */}\n              <div className=\"mb-6\">\n                <label htmlFor=\"bio\" className=\"label\">\n                  Décrivez votre activité\n                  <span className=\"text-secondary-400 font-normal ml-1\">(optionnel)</span>\n                </label>\n                <textarea\n                  id=\"bio\"\n                  value={bio}\n                  onChange={(e) => setBio(e.target.value)}\n                  className=\"input min-h-[120px] resize-none\"\n                  placeholder=\"Ex: Expert-comptable spécialisé dans les PME du secteur tech...\"\n                  maxLength={500}\n                />\n                <p className=\"text-sm text-secondary-400 mt-1 text-right\">\n                  {bio.length}/500\n                </p>\n              </div>\n\n              {/* Boutons */}\n              <div className=\"flex gap-3\">\n                <button\n                  onClick={() => setStep(1)}\n                  className=\"btn-secondary flex-1\"\n                  disabled={loading}\n                >\n                  Retour\n                </button>\n                <button\n                  onClick={handleSkip}\n                  className=\"btn-outline flex-1\"\n                  disabled={loading}\n                >\n                  Passer\n                </button>\n                <button\n                  onClick={handleComplete}\n                  disabled={loading}\n                  className=\"btn-primary flex-1\"\n                >\n                  {loading ? (\n                    <>\n                      <Loader2 className=\"w-5 h-5 animate-spin mr-2\" />\n                      ...\n                    </>\n                  ) : (\n                    <>\n                      Terminer\n                      <ArrowRight className=\"w-5 h-5 ml-2\" />\n                    </>\n                  )}\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Footer */}\n        <p className=\"text-center text-secondary-400 text-sm mt-8\">\n          Vous pourrez modifier ces informations plus tard dans les paramètres.\n        </p>\n      </div>\n    </div>\n  )\n}\n",
    "supabase_check_email.sql": "-- Fonction RPC pour vérifier si un email existe déjà dans auth.users\n-- Usage: SELECT check_email_exists('email@example.com');\n-- Retourne: true si l'email existe, false sinon\n\nCREATE OR REPLACE FUNCTION check_email_exists(email_to_check TEXT)\nRETURNS BOOLEAN\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nBEGIN\n  -- Vérifier si l'email existe dans auth.users\n  RETURN EXISTS (\n    SELECT 1 \n    FROM auth.users \n    WHERE email = email_to_check\n  );\nEND;\n$$;\n\n-- Permissions: Autoriser l'exécution pour les utilisateurs authentifiés et anonymes\nGRANT EXECUTE ON FUNCTION check_email_exists(TEXT) TO anon, authenticated;\n\n",
    "RAG_BRAIN_DOCUMENTATION.md": "# Documentation RAG-Brain - Edge Function Supabase\n\n## 📋 Vue d'ensemble\n\n`rag-brain` est une Edge Function Supabase qui implémente un système RAG (Retrieval-Augmented Generation) utilisant :\n- **OpenAI Embeddings** (`text-embedding-3-small`) pour la recherche sémantique\n- **OpenAI GPT-4o-mini** pour la génération de réponses\n- **Supabase Vector Search** via la fonction RPC `match_documents`\n\n## 🔗 Endpoint\n\n```\nPOST https://[VOTRE_PROJECT_ID].supabase.co/functions/v1/rag-brain\n```\n\n## 📥 Format de la requête\n\n### Headers requis\n```\nAuthorization: Bearer [ACCESS_TOKEN]\napikey: [ANON_KEY]\nContent-Type: application/json\n```\n\n### Body (JSON)\n\n```json\n{\n  \"query\": \"Votre question ici\",\n  \"vertical_id\": \"id-de-la-verticale\",\n  \"match_threshold\": 0.5,      // Optionnel, défaut: 0.7\n  \"match_count\": 5             // Optionnel, défaut: 5\n}\n```\n\n### Paramètres\n\n| Paramètre | Type | Requis | Défaut | Description |\n|-----------|------|--------|--------|-------------|\n| `query` | string | ✅ Oui | - | La question de l'utilisateur |\n| `vertical_id` | string | ✅ Oui | - | L'ID de la verticale pour filtrer les documents |\n| `match_threshold` | number | ❌ Non | 0.7 | Seuil de similarité (0-1). Plus bas = plus de résultats |\n| `match_count` | number | ❌ Non | 5 | Nombre maximum de documents à retourner |\n\n## 📤 Format de la réponse\n\n### Succès (200)\n\n```json\n{\n  \"success\": true,\n  \"answer\": \"Réponse générée par l'IA basée sur le contexte...\",\n  \"sources\": [\n    {\n      \"id\": \"doc-id-1\",\n      \"content\": \"Aperçu du contenu...\",\n      \"metadata\": {},\n      \"similarity\": 0.85\n    }\n  ],\n  \"processing_time_ms\": 1234\n}\n```\n\n### Erreur (400/500)\n\n```json\n{\n  \"success\": false,\n  \"error\": \"Message d'erreur détaillé\",\n  \"processing_time_ms\": 500\n}\n```\n\n## 🔧 Configuration requise\n\n### Variables d'environnement (Edge Function)\n\nLes variables suivantes doivent être configurées dans Supabase Dashboard → Functions → rag-brain → Settings :\n\n- `SUPABASE_URL` : URL de votre projet Supabase\n- `SUPABASE_SERVICE_ROLE_KEY` : Clé service role (accès complet)\n- `OPENAI_API_KEY` : Clé API OpenAI\n\n### Fonction RPC requise\n\nLa fonction `match_documents` doit exister dans votre base de données Supabase :\n\n```sql\n-- Exemple de signature attendue\nCREATE OR REPLACE FUNCTION match_documents(\n  query_embedding vector(768),\n  filter_vertical TEXT,\n  match_threshold FLOAT,\n  match_count INT\n)\nRETURNS TABLE (\n  id UUID,\n  content TEXT,\n  metadata JSONB,\n  similarity FLOAT\n)\n```\n\n## 🎯 Flux de traitement\n\n1. **Validation** : Vérifie que `query` et `vertical_id` sont présents\n2. **Embedding** : Génère l'embedding de la question via OpenAI\n3. **Recherche** : Appelle `match_documents` pour trouver les documents similaires\n4. **Construction du contexte** : Assemble les documents trouvés avec leurs métadonnées\n5. **Génération** : Envoie le contexte + question à GPT-4o-mini\n6. **Réponse** : Retourne la réponse avec les sources utilisées\n\n## 📝 Prompt système\n\nLe prompt système est défini dans l'Edge Function :\n\n```\nTu es un assistant expert spécialisé. Tu réponds aux questions en te basant UNIQUEMENT sur le contexte fourni.\n\nRÈGLES STRICTES:\n1. Base tes réponses EXCLUSIVEMENT sur le contexte fourni ci-dessous.\n2. Si le contexte ne contient pas l'information demandée, dis-le clairement.\n3. Ne jamais inventer d'informations non présentes dans le contexte.\n4. Cite les sources pertinentes quand c'est possible.\n5. Réponds en français de manière claire et professionnelle.\n```\n\n## 🔍 Dépannage\n\n### Erreur : \"Le champ 'query' est requis\"\n- Vérifiez que le body contient bien `query` (pas `message` ou autre)\n- Vérifiez que `query` n'est pas vide ou composé uniquement d'espaces\n\n### Erreur : \"Le champ 'vertical_id' est requis\"\n- Vérifiez que le body contient `vertical_id`\n- Assurez-vous que l'utilisateur/organisation a une verticale configurée\n\n### Erreur : \"OpenAI Embedding Error\"\n- Vérifiez que `OPENAI_API_KEY` est correcte\n- Vérifiez vos crédits OpenAI\n- Vérifiez que le modèle `text-embedding-3-small` est disponible\n\n### Erreur : \"Erreur recherche\"\n- Vérifiez que la fonction RPC `match_documents` existe\n- Vérifiez que la table de documents contient des embeddings\n- Vérifiez les logs Supabase pour plus de détails\n\n### Aucun document trouvé\n- Vérifiez que `match_threshold` n'est pas trop élevé (essayez 0.5 ou moins)\n- Vérifiez que des documents existent pour cette `vertical_id`\n- Vérifiez que les embeddings ont été générés correctement\n\n## 📊 Métriques\n\n- **Temps de traitement** : Inclus dans la réponse (`processing_time_ms`)\n- **Nombre de sources** : Disponible dans `sources.length`\n- **Similarité moyenne** : Calculable depuis `sources[].similarity`\n\n## 🔐 Sécurité\n\n- L'Edge Function utilise `SUPABASE_SERVICE_ROLE_KEY` pour accéder à la base\n- L'authentification utilisateur est requise (via `Authorization` header)\n- CORS est configuré pour autoriser les requêtes depuis le frontend\n\n## 🚀 Utilisation depuis le frontend\n\n### Exemple avec le helper `callRagBrain`\n\n```javascript\nimport { callRagBrain } from '../lib/supabaseClient'\n\nconst { data, error } = await callRagBrain(\n  \"Qu'est-ce que le RAG ?\",\n  \"vertical-id-123\",\n  {\n    matchThreshold: 0.5,\n    matchCount: 5\n  }\n)\n\nif (error) {\n  console.error('Erreur:', error.message)\n} else {\n  console.log('Réponse:', data.answer)\n  console.log('Sources:', data.sources)\n}\n```\n\n## 📚 Structure des sources\n\nChaque source retournée contient :\n\n```typescript\n{\n  id: string,              // ID du document\n  content: string,          // Aperçu du contenu (200 premiers caractères)\n  metadata: object,        // Métadonnées du document\n  similarity: number       // Score de similarité (0-1)\n}\n```\n\n## 🔄 Mise à jour du prompt système\n\nPour modifier le prompt système :\n\n1. Allez dans Supabase Dashboard → Functions → rag-brain\n2. Cliquez sur l'onglet \"Code\"\n3. Modifiez la constante `SYSTEM_PROMPT`\n4. Déployez la fonction\n\n## 📝 Notes de maintenance\n\n- **Date de création** : 2025-11-26\n- **Dernière mise à jour** : 2025-11-26\n- **Version** : 1.0.0\n- **Modèle OpenAI Embedding** : `text-embedding-3-small` (768 dimensions)\n- **Modèle OpenAI Chat** : `gpt-4o-mini`\n- **Temperature** : 0.3 (réponses déterministes)\n- **Max tokens** : 2048\n- **Match threshold par défaut** : 0.5 (configuré dans le frontend)\n\n## 🐛 Logs et debugging\n\nLes logs sont disponibles dans :\n- Supabase Dashboard → Functions → rag-brain → Logs\n\nLes logs incluent :\n- `[rag-brain] Requête: \"...\"`\n- `[rag-brain] Verticale: ...`\n- `[rag-brain] Génération de l'embedding...`\n- `[rag-brain] Recherche de documents...`\n- `[rag-brain] X documents trouvés`\n- `[rag-brain] Génération de la réponse...`\n- `[rag-brain] Réponse générée en Xms`\n\n## ⚙️ Configuration recommandée\n\n### match_threshold\n- **0.5** : Plus permissif, plus de résultats (recommandé pour la production - configuré par défaut)\n- **0.7** : Équilibré\n- **0.9** : Très strict, seulement les meilleures correspondances\n\n### match_count\n- **3-5** : Pour des réponses rapides et ciblées (défaut: 5)\n- **5-10** : Pour des réponses plus complètes\n- **10+** : Peut ralentir la génération et augmenter les coûts\n\n## 🔗 Liens utiles\n\n- [Documentation Supabase Edge Functions](https://supabase.com/docs/guides/functions)\n- [Documentation OpenAI Embeddings](https://platform.openai.com/docs/guides/embeddings)\n- [Documentation OpenAI Chat Completions](https://platform.openai.com/docs/guides/text-generation)\n\n## ⚠️ Configuration du vertical_id\n\n**IMPORTANT** : Le `vertical_id` est requis pour chaque requête. \n\n### Option 1 : Stocker dans la table `organizations`\n\n```sql\nALTER TABLE organizations \nADD COLUMN vertical_id TEXT;\n\nUPDATE organizations \nSET vertical_id = 'votre-vertical-id' \nWHERE vertical_id IS NULL;\n```\n\n### Option 2 : Stocker dans la table `profiles`\n\n```sql\nALTER TABLE profiles \nADD COLUMN vertical_id TEXT;\n```\n\n### Option 3 : Valeur par défaut temporaire\n\nLe frontend utilise actuellement `'default-vertical-id'` comme valeur temporaire avec un avertissement. **Cette valeur doit être remplacée** par une vraie verticale pour que le RAG fonctionne correctement.\n\n"
  },
  "changelog": {
    "2025-11-27": {
      "version": "1.1.0",
      "changes": [
        "Intégration complète de l'Edge Function rag-brain",
        "Ajout de la fonction callRagBrain dans supabaseClient.js",
        "Dashboard mis à jour avec interface de conversation RAG",
        "Gestion de l'historique de conversation",
        "Affichage des sources et métriques de traitement",
        "Avertissement pour configuration vertical_id",
        "match_threshold configuré à 0.5 par défaut",
        "Documentation RAG_BRAIN_DOCUMENTATION.md créée"
      ]
    },
    "2025-11-26": {
      "version": "1.0.0",
      "changes": [
        "Bloc 1 terminé et nettoyé",
        "Authentification complète",
        "Onboarding utilisateur",
        "Dashboard de base",
        "Page de paramètres"
      ]
    }
  },
  "integration_rag": {
    "status": "✅ Intégré et fonctionnel",
    "edge_function": "rag-brain",
    "endpoint": "https://[PROJECT_ID].supabase.co/functions/v1/rag-brain",
    "configuration": {
      "match_threshold": 0.5,
      "match_count": 5,
      "vertical_id": "Utilise 'default-vertical-id' temporairement avec avertissement"
    },
    "features": [
      "Appel à l'Edge Function depuis le frontend",
      "Gestion de l'authentification via session",
      "Affichage des réponses avec sources",
      "Historique de conversation",
      "Gestion des erreurs",
      "Avertissement si vertical_id non configuré"
    ]
  }
}